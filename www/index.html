<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>

<header>
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<title>CastleDB - The structured static database</title>
	<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css"/>
	<link rel="stylesheet" type="text/css" href="css/style.css"/>
	<script src="js/jquery.min.js"></script>
	<script src="js/bootstrap.min.js"></script>
</header>

<body>

<div id="page" class="home">

	<div class="navbar navbar-inverse navbar-fixed-top">
		<div class="navbar-inner">
			<div class="container">
				<a class="brand" href="/"><img src="img/icon.png"/> CastleDB</a>
				<em>The structured static database</em>
			</div>
		</div>
	</div>
		
	<div class="bg">
	<div class="container">
		
		<div class="head">
		
		<h1><img src="img/icon_hd.png"/> CastleDB</h1>
		
		<p class="tagLine">
			<b>CastleDB</b> is a structured static database easing collaboration.
		</p>
		
		<div class="img"><img src="img/screen.png"/></div>
		
		<div class="download">

		<a onclick="$('#download').slideToggle(200)" class="start btn btn-large btn-success"><i class="icon-download-alt icon-white"></i> Download</a>
		
		<div id="download" style="display:none">
		
		
			<a href="castledb-win.zip"><img src="img/win.png"/> Windows</a>
			
			<a href="castledb-osx.zip"><img src="img/osx.png"/> OSX</a>
			
			<a href="castledb-linux.zip"><img src="img/linux.png"/> Linux</a>

			<a href="http://github.com/ncannasse/castle"><img src="img/github.png"/> GitHub</a>

			<div class="ver">version 1.0</div>
			
		</div>
		
		</div>

		</div>
	</div>
	</div>

	<!--- INTRO ---------------------------------------------------------------------------------------- -->

	<div class="bg black">
	<div class="container">
		<div class="row">
			<div class="span6">
				<h3>Why</h3>
				<p>
					<b>CastleDB</b> is used to input structured static data.
				</p>
				<p>
					Everything that is usually stored in <b>XML</b> or <b>JSON</b> files is subject to be stored and modified with CastleDB instead.
				</p>
				<p>
					 For instance in a game you would like to have all of your items and monsters stored in it, including their names, description, logic effects, etc.
				</p>
			</div>

			<div class="span6">
				<h3>How</h3>
				<p>
					<b>CastleDB</b> looks like any spreadsheet editor, except that each sheet has a <em>data model</em>.
				</p>
				<p>
					The model allows the editor to validate and ease user input.
				</p>
				<p>
					For example a given column can reference another sheet row, so you will be able to select it directly.
				</p>
			</div>
			
		</div>

		<div class="row">
			<div class="span6">
				<h3>Storage</h3>
				<p>
					<b>CastleDB</b> store both its data model and rows data into an easily readable <b>JSON</b> file.
				</p>
				<p>
					It can then easily be loaded and used by any program.
				</p>
				<p>
					 For instance in a game you would like to have all of your items and monsters stored in it, including their names, description, logic effects, etc.
				</p>
			</div>

			<div class="span6">
				<h3>Collaboration</h3>
				<p>
					<b>CastleDB</b> allows efficient collaboration on data editing.
				</p>
				<p>
					It uses the JSON format with newlines to store its data, which allows RCS such as GIT or SVN to diff/merge the data files.
				</p>
				<p>
					Unlike online spreadsheet editors, changes are made locally, which allows local experiments before either commiting or reverting.
				</p>
			</div>
			
		</div>
	</div>
	</div>
	
	<!--- DATA MODEL ---------------------------------------------------------------------------------------- -->
	
	<div class="bg">
	<div class="container">

		<h1>The Data Model</h1>


		<div class="row">
		
			<div class="img"><img src="img/json.png"/></div>
			
			<p>
				A database consists in several <em>sheets</em>. Each sheet is a collection of structured object (similar to a TABLE in a traditional database).
			</p>
			
			<p>
				Each sheet consists in several named <em>columns</em>. The columns will represent the stored data object fields.
			</p>
			
			<p>
				Each column has a given <em>type</em> which represents the kind of data that is stored in this column.
			</p>
		
			<p>
				CastleDB handles column renaming, deleting, and conversion between column types.
			</p>
			
		</div>
		
		<div class="row">
		
			<h3>Column Types</h3>
			
			<p>
				The following types are available for columns types:
			</p>
			
			<dl class="dl-horizontal big">
			
			<dt>Unique Identifier</dt>
			<dd>
				This is an unique identifier for the current row. It will allows to <em>reference</em> this row from other sheets or columns. Unique identifiers must be valid code identifiers <code>[A-Za-z_][A-Za-z0_9_]*</code>.
			</dd>
			
			<dt>Text</dt>
			<dd>
				Any text can be input into this column. CastleDB currently does not allow multiline text.
			</dd>
			
			<dt>Boolean</dt>
			<dd>
				A checkbox will allow to specify if the column is <code>true</code> or <code>false</code>.
			</dd>
			
			<dt>Integer</dt>
			<dd>
				A integer number (which does not have fractional component).
			</dd>
			
			<dt>Float</dt>
			<dd>
				Any number.
			</dd>
			
			<dt>Enumeration</dt>
			<dd>
				An exclusive choice between a number of given custom values. For instance <code>Yes,No,Cancel,Error</code>
			</dd>
			
			<dt>Flags</dt>
			<dd>
				Several optional choices between a list of given custom values. For instance <code>hasHat,hasShirt,hasShoes</code>.
			</dd>
			
			<dt>Reference</dt>
			<dd>
				A reference to another sheet row, using its unique idenfier.
			</dd>
			
			<dt>Image</dt>
			<dd>
				An image to be displayed.
			</dd>
			
			<dt>List</dt>
			<dd>
				A list of structured values <a href="#list">learn more</a>.
			</dd>
			
			<dt>Custom</dt>
			<dd>
				A custom type <a href="#custom">learn more</a>.
			</dd>
			
			</dl>
			
			<h3>Column Storage and default value</h3>
			
			<p>
				The following table tells how each type is stored into the CDB/JSON file:
			</p>
			
			<table class="table table-striped">
			<tr>
				<th>Column Type</th>
				<th>Storage</th>
				<th>Default Value</th>
			</tr>
			<tr>
				<td>Unique Identifier</td>
				<td>the identifier String</td>
				<td><code>""</code></td>
			</tr>
			<tr>
				<td>Text</td>
				<td>the text String</td>
				<td><code>""</code></td>
			</tr>
			<tr>
				<td>Boolean</td>
				<td><code>true</code> or <code>false</code></td>
				<td><code>false</code></td>
			</tr>
			<tr>
				<td>Integer</td>
				<td>the integer value</td>
				<td><code>0</code></td>
			</tr>
			<tr>
				<td>Float</td>
				<td>the number value</td>
				<td><code>0</code></td>
			</tr>
			<tr>
				<td>Enumeration</td>
				<td>the integer index of the selected value</td>
				<td><code>0</code> (first value)</td>
			</tr>
			<tr>
				<td>Flags</td>
				<td>a bit is set for each index of the selected values</td>
				<td><code>0</code> (no selected value)</td>
			</tr>
			<tr>
				<td>Reference</td>
				<td>the string of the target unique identifier</td>
				<td><code>""</code> (missing identifier)</td>
			</tr>
			<tr>
				<td>Image</td>
				<td>the string of the MD5 of the image content bytes</td>
				<td><code>""</code> (missing image)</td>
			</tr>
			<tr>
				<td>List</td>
				<td>an Array of structured objects <a href="#list">learn more</a></td>
				<td><code>[]</code> (empty array)</td>
			</tr>
			<tr>
				<td>Custom</td>
				<td>a mixed array representation <a href="#custom">learn more</a></td>
				<td><code>null</code> (missing type)</td>
			</tr>
			</table>

			<h3>Optional Column</h3>
			
			<p>
				If you uncheck the <b>Required</b> checkbox when creating/modifying a column, default data will be <code>null</code>. It will also remove the field from the stored object in case no data is present.
			</p>
			
		</div>

    </div>
	</div>

	<!--- USAGE ---------------------------------------------------------------------------------------- -->

	<div class="bg blue">
	<div class="container">	
	
		<h1>Using CastleDB Editor</h1>
		
		<div class="row">
		
		<div class="img"><img src="img/using.png"/></div>
		
		<h3>Loading and Saving</h3>
		
		<p>
			Using the File menu, you can create a <code>New</code> file and <code>Load</code> and <code>Save As</code> your <code>.cdb</code> file.
		</p>
		
		<p>
			Everytime you make a change, the database file is automatically saved.
		</p>
		
		<h3>Keys</h3>
		
		<p>
			Here's the most used keys for CastleDB:
		</p>
		
		<ul>
		<li>Arrows are used to navigate between the cells. You can start typing to replace the cell content or use <code>F2</code> or <code>Enter</code> to edit it.</li>
		<li>Use <code>Esc</code> to exit cell edition or close opened List</li>
		<li>Use <code>Insert</code> to insert a new row at the cursor position</li>
		<li>Use <code>Ctrl+Z</code> and <code>Ctrl+Y</code> to Undo/Redo your changes</li>
		<li>Use <code>Tab</code> and <code>Shift+Tab</code> to navigate to next/prev cell on the same row</li>
		<li>Use <code>F4</code> to go the row referenced by the cell and <code>F3</code> to search for references of this row"</li>
		</ul>
		
		<h3>Managing sheets</h3>
		
		<p>
			In order to manage sheets, right click on the sheet title in the bottom bar of the editor. You will be able to:
		</p>
		<ul>
			<li>Add a new sheet</li>
			<li>Move the sheet to reorder them</li>
			<li>Rename and Delete the sheet</li>
			<li>Access sheet options such as <a href="#index">Index</a> and <a href="#group">Groups</a></li>
		</ul>
		
		<h3>Managing columns</h3>
		
		<p>
			Right click on the column title in order to access to the following options:
		</p>
		<ul>
			<li>Edit the column, which allows to rename it, change its type and required flag.</li>
			<li>Move the column to reorder them</li>
			<li>Add a new column</li>
			<li>Delete the column or set it as <a href="#disp">Display Column</a></li>
			<li>Convert the column content if some convert functions are available for this type.</li>
		</ul>
				
		<p>
			CastleDB offers automatic conversion between column types, which is used when changing the column type or copy/pasting data between columns/sheets.
		</p>
		
		<p>
			If no convertion is available, you will get an error when changing the column type.
		</p>

		<h3>Managing rows</h3>
		
		<p>
			Right click on a row index to select the row and access the following options:
		</p>
		
		<ul>
			<li>Move Up and Down the row, which can also be triggered by using <code>Ctrl+Up</code> and <code>Ctrl+Down</code> arrows</li>
			<li>Insert a new row at the cursor position, same as <code>Insert</code> key</li>
			<li>Delete the selected row(s), same as <code>Delete</code> key</li>
			<li>Insert or remove a <a href="#sep">Separator</a> for this row</li>
			<li>look for the references pointing to this row (requires an unique identifier)</li>
		</ul>

		<h3>Selection</h3>
		
		<p>
			You can select one row by clicking on its index, then select several of them by clicking while olding shift on another row index.
		</p>
		
		<p>
			You can select a range of cells by first selecting a cell then clicking while holding shift on another cell.
		</p>
		
		<p>
			You can Copy/Paste using <code>Ctrl+C</code>, <code>Ctrl+V</code> and <code>Ctrl+X</code> between columns and rows.
		</p>

		</div>
	
	</div>
	</div>

	<!--- CUSTOM ---------------------------------------------------------------------------------------- -->

	<div class="bg">
	<div class="container">

		<h1>More Features</h1>
	
		<div class="row">

			<a class="anch" name="disp"></a>
			<h3>Display Column</h3>
			
			<p>
				If you right click on a column and check <code>Display Column</code>, this column will be used instead of the unique identifier when displaying a row reference.
			</p>
			
			<p>
				This can be useful for instance to display the real name of an item instead of its unique identifier.
			</p>
			
			<p>
				The stored data and that data input is still made using the unique identifier, this only affects how things are displayed in CastleDB editor.
			</p>
		
			<a class="anch" name="index"></a>
			<h3>Index</h3>
			
			<p>
				When you open CastleDB, each row is referenced by an 0-based index. 
			</p>
			
			<p>
				Usually this index is not part of the exported data but you can add it by right-clicking on the sheet name, then check <code>Index</code>. It will add an <code>index</code> object field to your data.
			</p>
			
			<p>
				For List column types, the index will be unique for the given column.
			</p>
			
			<a class="anch" name="sep"></a>
			<h3>Separators</h3>
			
			<p>
				If you right click on a row index, you can check <code>Separator</code> which will create a small visible separator between this row and the previous one.
			</p>
			
			<p>
				You can also double-click on the separator to name it.
			</p>

			<a class="anch" name="group"></a>
			<h3>Add Group</h3>
			
			<p>
				If you right-click on the sheet name and check the <code>Add Group</code>, it will create for each row a <code>group</code> field that will be an integer index.
			</p>
			
			<p>
				The index starts at 0, then each time a new separator with a title set is reached, it will increment by one (unless the first row separator has a title).
			</p>
			
			<p>
				This will allow you to categorize your sheet rows easily without having to create a specific column for it.
			</p>

		</div>
	</div>
	</div>

	<!--- CUSTOM ---------------------------------------------------------------------------------------- -->

	<div class="bg blue">
	<div class="container">

		<h1>Advanced Types</h1>

		<div class="row">
		
			<a class="anch" name="list"></a>
			<h3>List Column Type</h3>
			
			<p>
				When you set the type of a column as <code>List</code> this will create a new hidden sheet.
			</p>
			
			<p>
				You can then add columns to this sub-sheet and modify it as you would for another sheet.
			</p>
			
			<p>
				However the difference is that the data of this sheet is split between your original sheet rows.
			</p>
			
			<p>
				You can click on the list to toggle its content and insert rows into it.
			</p>
			
			<p>
				A List is similar to the one-to-many database association.
			</p>
			
			<a class="anch" name="img"></a>
			<h3>Image</h3>
			
			<p>
				The images inserted into the database are stored into a separate <code>.img</code> file. Only the MD5 key of the image is stored into the <code>.cdb</code> database.
			</p>
			
			<p>
				As a consequence it means that the same image can be used multiple times without increasing overall file size.
			</p>
			
			<p>
				If you do a lot of images changes, you can use the <code>Clean Images</code> command in the application File menu. This will remove from the <code>.img</code> file all images that are no longer used. 
			</p>

			<a class="anch" name="custom"></a>
			<h3>Custom Types</h3>
			
			<p>
				Custom types are a structured type declared as enums, consisting in several <em>constructors</em>.
			</p>
			
			<p>
				Custom types can be created and modified by using the <code>Edit Types</code> link at the bottom-right of the editor.
			</p>
			
			<p>
				Here's an example of a custom type with four constructors:
			</p>
			<pre><span class="kwd">enum</span> MyCustomType {
	Fixed;
	Random( v : Float );
	Monster( ?m : monsters );
	Or( a : MyCustomType, b : MyCustomType );
}</pre>

			<p>
				In that case, a column of this custom type can be one of the following values:
			</p>
			
			<pre>Fixed
Random(0.5)
Monster(MyMonsterId)
Or(Random(0.5),Fixed)</pre>

			<p>
				A custom type constructor parameter can use the following types:
			</p>
			
			<ul>
			<li><code>Int</code> : an integer value</li>
			<li><code>Bool</code> : a boolean value</li>
			<li><code>Float</code> : any number value</li>
			<li><code>String</code> : a string value</li>
			<li><code>CustomType</code> : any custom type, including itself</li>
			<li><code>SheetName</code> : any sheet name created in the database</li>
			</ul>
			
			<p>
				If a constructor parameter is prefixed with a <code>?</code>, then it means it's optional and can be omited.
			</p>
			
			<p>
				Custom types are stored as a mixed array content. The first element of the Array is the index in the constructors list, followed by the eventual parameters for this constructor.
			</p>

			<table class="table table-striped">
			<tr>
				<th>Value example</th>
				<th>Stored value</th>
			</tr>
			<tr>
				<td><code>Fixed</code></td>
				<td><code>[0]</code></td>
			</tr>
			<tr>
				<td><code>Random(0.5)</code></td>
				<td><code>[1,0.5]</code></td>
			</tr>
			<tr>
				<td><code>Monster(MyMonsterId)</code></td>
				<td><code>[2,"MyMonsterId"]</code></td>
			</tr>
			<tr>
				<td><code>Or(Random(0.5),Fixed)</code></td>
				<td><code>[3,[1,0.5],[0]]</code></td>
			</tr>
			</table>
	
			<p>
				Custom type input is strictly validated by CastleDB editor.
			</p>
	
		</div>
	</div>
	</div>

	<!--- HAXE ---------------------------------------------------------------------------------------- -->
	
	<div class="bg">
	<div class="container">

		<h1>Haxe Integration</h1>

		<div class="row">

			<div class="img"><img src="img/haxelogo.png"/></div>
			
			<p>
				CastleDB was created using the <a href="http://haxe.org">Haxe</a> technology, it also allows some Haxe-specific integration.
			</p>
			
			<p>
				The powerful Haxe Macros will allow to directly generate all the types declaration from the CastleDB Data Model.
			</p>
			
			<p>
				This is simply done by creating a source file such as:
			</p>
			
			<pre><span class="cmt">// Data.hx</span>
<span class="kwd">private typedef</span> Init = haxe.macro.MacroType&lt;[cdb.Module.build(<span class="str">"myDataFile.cdb"</span>)]&gt;;
</pre>
			
			<p>
				When compiling with <code>-lib castle</code>, this will create all the types stored in the CDB model.
			</p>
			
			<p>
				You can still initialize at runtime your CDB data, then access it using the accessors:
			</p>
			
			<pre>
<span class="kwd">var</span> content : String = .... <span class="cmt">// load CDB file content</span>
Data.load(content);
Data.monsters.all; <span class="cmt">// all the objects of the "monsters" sheet</span>
<span class="kwd">var</span> dragon : Data.Monsters = Data.monsters.get(Dragon); <span class="cmt">// using the unique ID generated enum</span>
trace(d.loot.name); <span class="cmt">// automatically fetch the Refenced objects</span></pre>
			
			<p>
				All the accesses are strictly typed by Haxe.
			</p>
			
			<h3>Generated types</h3>
			
			<p>
				The main type of the module is generated with the <code>load</code> static field and for each declared sheet a static field corresponding to the sheet name.
			</p>

			
			<p>
				If the sheet does not have an unique identifier, only the <code>all</code> field is available.
			</p>
			
			<p>
				If the sheet has an unique identifier, you can access the <code>all</code> field, but also use <code>get</code> (by id) and <code>resolve</code> (by string).
			</p>
			
			<p>
				For each sheet named <code>mySheet</code> we will generate the following types:
			</p>
			<ul>
				<li><code>MySheetDef</code> is the original object as parsed by JSON.</li>
				<li><code>MySheet</code> is an abstract type that allows only reading the fields and perform some conversions (see below)</li>
				<li><code>MySheetKind</code> is an enum containing all the unique identifiers found in <code>mySheet</code></li>
			</ul>
			
			<p>
				The <code>MySheetKind</code> type is an abstract value so the actual runtime value is still the identifier string, however it allows for strictly typing the identifiers. You can still use <code>.toString()</code> to access the original string.
			</p>

			<h3>Column type mapping</h3>
			
			<p>
				The different column types are mapped to the following types:
			</p>
			
			<dl class="dl-horizontal big">
				<dt>Unique Identifier</dt>
				<dd>
					<code>SheetNameKind</code> : an abstract enum is created for each sheet
				</dd>
				
				<dt>Text</dt>
				<dd>
					<code>String</code>
				</dd>
				
				<dt>Boolean</dt>
				<dd>
					<code>Bool</code>
				</dd>
				
				<dt>Integer</dt>
				<dd>
					<code>Int</code>
				</dd>
				
				<dt>Float</dt>
				<dd>
					<code>Float</code>
				</dd>
				
				<dt>Enumeration</dt>
				<dd>
					<code>SheetName_ColumName</code> : an abstract enum is created. If they have the same values in the same order, they are all aliases to the same enum.
				</dd>
				
				<dt>Flags</dt>
				<dd>
					<code>cdb.Module.Flags&lt;SheetName_ColumnName&gt;</code> : an abstract enum is created as for Enumeration. The bits are wrapped using the <code>Flags</code> abstract which allows typed <code>has</code> and <code>iterator</code> methods.
				</dd>
				
				<dt>Reference</dt>
				<dd>
					<code>TargetSheetName</code> : referenced object is fetched when accessed. You can access only the identifier by using <code><em>columnName</em>Id</code> field.
				</dd>
				
				<dt>Image</dt>
				<dd>
					<code>String</code> : the MD5 key only, no image loading is supported atm.
				</dd>
				
				<dt>List</dt>
				<dd>
					<code>cdb.Module.ArrayRead&lt;SheetName_ColumnName&gt;</code> : a read-only array of the structured objects, allows indexed access, length and iteration.
				</dd>
				
				<dt>Custom</dt>
				<dd>
					<code>SheetName_ColumnName</code> : values are converted on-the-fly to the enum created as it's been declared.
				</dd>
			</dl>
			
			<h3>Example</h3>
			
			<p>
				You can see a small example of Haxe integration on GitHub <a href="https://github.com/ncannasse/castle/tree/master/src/test">here</a>.
			</p>
			
			<p>
				If you want to see what code is being actually generated, you can compile with <code>-D dump=pretty</code> and look at the <code>dump</code> directory after successful compilation.
			</p>
			
			<p>
				<b style="color:#A00">Warning</b> : castle library require either Haxe 3.2+ or a recent Haxe build to work. You can download it from <a href="http://hxbuilds.s3-website-us-east-1.amazonaws.com/builds/haxe/">this page</a>
			</p>
			
		</div>
	</div>	
	</div>

	<!--- ABOUT ---------------------------------------------------------------------------------------- -->
	
	<div class="bg black last">
	<div class="container">

		<div class="row">
		
			<h3>About</h3>
			
			<p>
				CastleDB was created by <a href="https://twitter.com/ncannasse">@ncannasse</a> using <a href="http://haxe.org">Haxe</a> and <a href="https://github.com/rogerwang/node-webkit">Node Webkit</a>. It's hosted on <a href="http://github.com/ncannasse/castle">GitHub</a> and used professionally by <a href="http://shirogames.com">Shiro Games</a>.
			</p>
			
			<p>
				CastleDB is an open source software usable in commercial projects without any restriction.
			</p>
			
			<div class="p">
				If you wish to help CastleDB development, you can 
			<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="BRFRPK8TYXYEC">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" style="border:none" src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif" width="1" height="1">
</form>
			</div>
						
		</div>
	</div>	
	
</div>
</body>

</html>